services:
  edge:
    build:
      context: .
      dockerfile: docker/Dockerfile
    container_name: mini_pacs_edge
    depends_on:
      - postgres
    environment:
      POSTGRES_HOST: postgres
      POSTGRES_PORT: 5432
      POSTGRES_DB: mini_pacs
      POSTGRES_USER: mini_pacs
      POSTGRES_PASSWORD: mini_pacs
    ports:
      - "11112:11112"
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - ./config.yaml:/app/config.yaml
    restart: unless-stopped
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: mini_pacs
      POSTGRES_USER: mini_pacs
      POSTGRES_PASSWORD: mini_pacs
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
    restart: unless-stopped
  orthanc:
    image: orthancteam/orthanc:latest
    container_name: mini_pacs_orthanc
    ports:
      - "4242:4242"
      - "8042:8042"
    volumes:
      - ./data/orthanc:/var/lib/orthanc/db
      - ./orthanc.json:/etc/orthanc/orthanc.json
    environment:
      ORTHANC__HTTP_ACCESS_CONTROL_ALLOW_ORIGIN: "*"
      ORTHANC__HTTP_ACCESS_CONTROL_ALLOW_METHODS: "GET, POST, PUT, DELETE, OPTIONS"
      ORTHANC__HTTP_ACCESS_CONTROL_ALLOW_HEADERS: "Origin, Accept, Content-Type"
    restart: unless-stopped
  ohif:
    image: ohif/viewer:latest
    container_name: mini_pacs_ohif
    depends_on:
      - orthanc
    ports:
      - "3000:80"
    volumes:
      - ./ohif-app-config.js:/usr/share/nginx/html/app-config.js:ro
      - ./ohif-nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ./ohif-init-service-worker.js:/usr/share/nginx/html/init-service-worker.js:ro
    restart: unless-stopped
  app01:
    build:
      context: .
      dockerfile: docker/Dockerfile
    entrypoint: ["python", "-u", "-m", "worker.worker_scp"]
    environment:
      WORKER_AE_TITLE: "APP01"
      WORKER_PORT: 11112
      GATEWAY_HOST: "edge"
      GATEWAY_PORT: 11112
      GATEWAY_AE_TITLE: "MINI_EDGE"
    expose:
      - "11112"
    restart: unless-stopped
  app02:
    build:
      context: .
      dockerfile: docker/Dockerfile
    entrypoint: ["python", "-u", "-m", "worker.worker_scp"]
    environment:
      WORKER_AE_TITLE: "APP02"
      WORKER_PORT: 11112
      GATEWAY_HOST: "edge"
      GATEWAY_PORT: 11112
      GATEWAY_AE_TITLE: "MINI_EDGE"
    expose:
      - "11112"
    restart: unless-stopped
  app03:
    build:
      context: .
      dockerfile: docker/Dockerfile
    entrypoint: ["python", "-u", "-m", "worker.worker_scp"]
    environment:
      WORKER_AE_TITLE: "APP03"
      WORKER_PORT: 11112
      GATEWAY_HOST: "edge"
      GATEWAY_PORT: 11112
      GATEWAY_AE_TITLE: "MINI_EDGE"
    expose:
      - "11112"
    restart: unless-stopped
  app04:
    build:
      context: .
      dockerfile: docker/Dockerfile
    entrypoint: ["python", "-u", "-m", "worker.worker_scp"]
    environment:
      WORKER_AE_TITLE: "APP04"
      WORKER_PORT: 11112
      GATEWAY_HOST: "edge"
      GATEWAY_PORT: 11112
      GATEWAY_AE_TITLE: "MINI_EDGE"
    expose:
      - "11112"
    restart: unless-stopped
  app05:
    build:
      context: .
      dockerfile: docker/Dockerfile
    entrypoint: ["python", "-u", "-m", "worker.worker_scp"]
    environment:
      WORKER_AE_TITLE: "APP05"
      WORKER_PORT: 11112
      GATEWAY_HOST: "edge"
      GATEWAY_PORT: 11112
      GATEWAY_AE_TITLE: "MINI_EDGE"
    expose:
      - "11112"
    restart: unless-stopped
